---
title: 'Monorepo란 무엇일까? - 모노레포에 대해 알아보기'
tags:
  - javascript
  - nodejs
published: false
date: 2022-02-22 18:37:46
description: ''
---

## Introduction

Monorepo(이하 모노레포)라는 용어는 프론트엔드 개발을 하다보면 여기저기서 한번쯤 들어봤을 것이다. 이번 아티클에서는 모노레포가 무엇이고, 어떤 이점이 있는지, 그리고 모노레포를 만들 수 있는 다양한 라이브러리에 대해 알아보려고 한다.

## 모노레포란 무엇인가?

### 정의

모노레포란 서로 관계를 가진 여러 개별 프로젝트를 포함시킨 하나의 단일 저장소라고 볼 수 있다. 우리가 잘 알고 있는 라이브러리들을 살펴보면, 모두 모노레포로 구성되어 있는 것을 알 수 있다.

- https://github.com/vercel/next.js/
- https://github.com/babel/babel
- https://github.com/facebook/react

위 저장소 들의 공통점은 모두 모노레포로 구성되어 있으며, 여러 개별 프로젝트가 `packages/` 하위 디렉토리에 존재한다는 것이다. vercel의 `next.js`를 먼저 살펴보자. `next.js`가 제공하는 라이브러리가 여러가지가 있는데, 이들은 모두 `next.js` 프레임워크를 기본으로 한다는 공통점을 가지고 있다. `next.js`라는 공통 관심사를 가진 여러 개별 패키지를 모노레포로 관리해두고 있는 것이다.

![monorepo](https://monorepo.tools/images/monorepo-polyrepo.svg)

여러 프로젝트가 하나의 저장소에 그냥 존재한다고 가정해보자. 그냥 단순히 존재하기만 하고, 이들 사이에 관계가 없다면 모노레포로 부를 수 없을 것이다.

### 왜 생겨났을까?

모노레포의 반대말을 폴리레포(Polyrepo)라고 해보자. 폴리레포란 각 팀당 하나의 레포, 애플리케이션 또는 애플리케이션을 가지고 개발하는 방법론중 하나다. 그리고 각 레포는 하나의 빌드 아티팩트와 빌드 파이프라인을 가지고 있다.

그러나 이렇게 개별 팀이 각각 다르게 구성해서 일해야 할까? 이러한 팀별 자율성은 고립에 의해 만들어지고, 고립은 협력을 해친다. 폴리레포의 단점은 다음과 같이 요약할 수 있다.

- 번거로운 코드 공유: 레파지토리간에 코드를 공유하려면 공유 코드를 위한 레파지토리를 만들어야 한다. 툴링 및 CI환경을 설정하고, repo에 커밋을 추가하고, 다른 레파지토리가 의존할 수 있도록 패키지를 publish 해주어야 한다.
- 코드 중복: 앞선 공유 레포를 설정하는 번거로움 때문에, 각 레포에 공통 서비스와 컴포넌트를 각자 구현하기 시작한다. 이로 인해 초기 시간 낭비는 막을 수는 있겠지만, 결국 서비스가 진화 함에 따라 유지보수, 보안, 품질 관리 등에 어려움을 겪게 된다.
- 공유 라이브러리 및 라이브러리 사용자의 부담: 공유 라이브러리에 버그나 변경사항이 있다고 가정해보자. 개발자는 이 변경사항을 게시하고 적용하는 것 뿐 만 아니라 이를 사용하고 있는 다른 레파지토리에 가서 패키지를 버저닝을 업데이트하고, 릴리즈하는 등의 노력을 기울여야 한다.
- 일관성 없는 도구: 각 프로젝트는 테스트 실행, 빌드, 서비스, 린팅, 배포 등 자체 명령어 집합과 도구를 사용하게 된다. 이러한 프로젝트간의 파편화는 사용해야할 명령어로 기억해야 하는 정신적인 오버헤드를 야기한다.

### 특징

- 새 프로젝트를 생성하는데 오버헤드가 적음: 모든 컨슈머가 같은 레포에 있을 경우, 기존 CI 설정을 사용하면 되고, publish를 새롭게 하거나, 설정을 하는데 적은 노력을 기울여도 된다.
- 프로젝트간 아토믹 커밋: 모든 것이 하나의 커밋단위로 작동하게 된다. 같은 커밋 내에서 수정한다면, breaking changes도 존재하지 않는다.
- 단일 버전으로 통일: 하나의 버전아래에서 모두 작동하므로 호환이 깨지는 걱정을 할 필요가 없다.
- 개발자 편의: 다양한 도구와 기술을 사용하면서도, 애플리케이션을 일관성 있게 작성하고 테스트 할 수 있다. 개발자는 보다 자신감 있게 다른 패키지의 애플리케이션에 기여하고 변경사항이 안전한지 확인할 수 있다.

## 모노레포가 제공하는 기능

모노레포는 많은 장점을 가지고 있지만, 이를 활용하기 위해서는 적절한 도구가 필요하다. workspace가 커짐에 따라 툴은 신혹하고, 이해하기 쉬우며, 관리가 용이하도록 지원해야 한다.

### 로컬 연산 캐싱

파일을 저장하는 작업이나, 다양한 태스크 작업 결과를 캐싱하는 기능을 의미한다. 같은 머신에서는 동일한 아웃풋을 두번 만들거나, 중복 테스트 하지 않는 것을 의미한다.

### 로컬 작업 오케스트레이션

태스크를 올바른 순서로, 그리고 병렬로 실행할 수 있는 기능.

### 분산 연산 캐싱

여러 다양한 환경에서 캐시 아티팩트를 공유할 수 있다. 즉, CI 에이전트를 포함하여 조직 전체에서 동일한 것을 두번 빌드하거나 테스트 하지 않는다. 앞서 로컬 연산 캐싱은 로컬에서의 작업만을 의미했다면, 이것은 서로다른 환경에서도 캐싱이 되는 것을 의미한다.

### 분산 작업 실행

단일 머신에서 실행한 명령어를 여러 머신에 분산 실행시키는 기능

###
